groups:
- name: sla_violations
  rules:
  - alert: LowUptime
    expr: avg_over_time(probe_success{job="blackbox", instance=~".*/health"}[1m]) < 0.999
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Uptime quá thấp cho {{ $labels.instance }}"
      description: "Uptime < 99.9% trong 1 phút, hiện tại: {{ $value | printf \"%.2f\" }}"

  - alert: HighLatency
    expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{job="node-app"}[5m])) by (le)) > 0.5
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "Latency P95 cao"
      description: "P95 > 500ms, hiện tại: {{ $value | printf \"%.3f\" }}s"
